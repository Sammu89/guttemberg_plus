# File Structure & Module Guide

**Directory tree with implementation guidance**

---

## Project Root

```
gutenberg-blocks-plugin/
├── docs/                        ← You are here
├── src/
│   ├── shared/                  ← Phase 1 (MUST complete first)
│   ├── blocks/                  ← Phase 2-4 (can parallelize)
│   └── php/                     ← PHP backend
├── build/                       ← Generated (do not edit)
├── assets/
│   └── css/                     ← CSS defaults (single source of truth)
├── build-tools/                 ← Custom webpack loaders
├── webpack.config.js
├── package.json
└── README.md
```

## Shared Infrastructure (Phase 1)

```
src/shared/
├── theme-system/
│   ├── cascade-resolver.js      READ: 11-CASCADE-SYSTEM.md
│   │                            CUSTOM - Pure function, <5ms
│   │                            DO NOT integrate with @wordpress/data
│   │
│   └── theme-manager.js         READ: 12-THEME-SYSTEM.md
│                                Thin wrapper over @wordpress/data store
│
├── data/
│   ├── store.js                 READ: 24-WORDPRESS-INTEGRATION.md
│   │                            @wordpress/data Redux store
│   │                            Theme CRUD only, NOT cascade
│   │
│   └── index.js                 Export store
│
├── components/
│   ├── ThemeSelector.js         READ: 41-THEME-SELECTOR-UI.md
│   │                            CUSTOM - Complex dropdown with custom variants
│   │
│   ├── ColorPanel.js            READ: 40-EDITOR-UI-PANELS.md
│   ├── TypographyPanel.js       Uses @wordpress/components
│   ├── BorderPanel.js           Wraps WP components with customization badges
│   ├── SpacingPanel.js
│   ├── IconPanel.js
│   └── CustomizationWarning.js  CUSTOM - Workflow dialogs
│
├── attributes/
│   ├── color-attributes.js      READ: 30-SHARED-ATTRIBUTES.md
│   ├── typography-attributes.js All default to null (cascade)
│   ├── border-attributes.js
│   ├── spacing-attributes.js
│   ├── icon-attributes.js
│   └── meta-attributes.js       currentTheme, customizations, uniqueId
│
└── utils/
    ├── css-parser.js            READ: 23-CSS-PARSING-SYSTEM.md
    │                            Load window.{blockType}Defaults
    │
    ├── id-generator.js          READ: 01-QUICK-REFERENCE.md
    │                            4-digit alphanumeric IDs
    │
    ├── aria-helpers.js          READ: 31-ACCORDION-SPEC.md (ARIA section)
    │                            Sync ARIA with visual state
    │
    ├── keyboard-nav.js          Block-specific keyboard handlers
    └── validation.js            Input validation
```

## Blocks (Phase 2-4)

```
src/blocks/
├── accordion/
│   ├── src/
│   │   ├── index.js             READ: 31-ACCORDION-SPEC.md
│   │   │                        Block registration
│   │   │
│   │   ├── edit.js              Uses shared components + store
│   │   │                        useSelect/useDispatch for themes
│   │   │                        getAllEffectiveValues for cascade
│   │   │
│   │   ├── save.js              Generate HTML with resolved values
│   │   │                        Apply ARIA attributes
│   │   │
│   │   ├── accordion.css        READ: 23-CSS-PARSING-SYSTEM.md
│   │   │                        :root variables = defaults
│   │   │                        Parsed at build time → PHP
│   │   │
│   │   └── frontend.js          Toggle interactions
│   │                            Keyboard navigation
│   │
│   ├── block.json               Imports shared + accordion-specific attrs
│   └── build/                   Generated
│
├── tabs/
│   ├── src/
│   │   ├── index.js             READ: 32-TABS-SPEC.md
│   │   ├── edit.js              Similar to accordion
│   │   ├── save.js              Tabs-specific HTML + ARIA
│   │   ├── tabs.css             Tabs defaults
│   │   └── frontend.js          Tab switching + responsive fallback
│   │
│   ├── block.json
│   └── build/
│
└── toc/
    ├── src/
    │   ├── index.js             READ: 33-TOC-SPEC.md
    │   ├── edit.js              Heading detection
    │   ├── save.js              TOC HTML structure
    │   ├── toc.css              TOC defaults
    │   └── frontend.js          Optional: Collapse behavior, smooth scroll
    │
    ├── block.json
    └── build/
```

## PHP Backend

```
src/php/
├── css-defaults/                ← AUTO-GENERATED (do not edit manually)
│   ├── accordion.php            Generated by webpack loader
│   ├── tabs.php                 Parsed from CSS :root variables
│   └── toc.php                  Used by get_{blockType}_defaults()
│
├── theme-storage.php            READ: 22-PHASE-1-SHARED-INFRASTRUCTURE.md
│                                Database operations for themes
│                                get_option / update_option
│
└── theme-rest-api.php           REST API endpoints
                                 GET/POST/PUT/DELETE /gutenberg-blocks/v1/themes
```

## Build System

```
build-tools/
└── css-vars-parser-loader.js    READ: 21-PHASE-0-BUILD-SYSTEM.md
                                 Custom webpack loader
                                 Parses CSS :root → generates PHP arrays

webpack.config.js                Multiple entry points
                                 CSS parser integration
                                 @wordpress/scripts base config

package.json                     Dependencies + scripts
                                 npm start / npm run build
```

## Assets

```
assets/
└── css/
    ├── accordion.css            :root CSS defaults for accordion
    ├── tabs.css                 :root CSS defaults for tabs
    └── toc.css                  :root CSS defaults for TOC
```

## Module Dependencies

### Phase 0 (Build System)
```
webpack.config.js
  └── css-vars-parser-loader.js
      └── Generates: php/css-defaults/*.php
```

### Phase 1 (Shared Infrastructure)
```
1. CSS Parsing (css-parser.js, css-parser.php)
2. Cascade Resolver (cascade-resolver.js) ← Independent
3. WordPress Data Store (store.js)
4. Theme Storage PHP (theme-storage.php, theme-rest-api.php)
5. Theme Manager (theme-manager.js) ← Wraps store.js
6. Shared Attributes (attributes/*.js)
7. Shared Components (components/*.js) ← Uses 1-6
8. Shared Utilities (utils/*.js)
```

### Phase 2-4 (Blocks)
```
Each block:
  ├── Uses: All Phase 1 modules
  ├── CSS: {blockType}.css
  └── Specific: block.json, edit.js, save.js, frontend.js
```

## What to Read When

### "I need to implement cascade resolution"
1. Read: 11-CASCADE-SYSTEM.md
2. Implement: shared/theme-system/cascade-resolver.js
3. Test: <5ms for getAllEffectiveValues()

### "I need to implement theme storage"
1. Read: 12-THEME-SYSTEM.md
2. Read: 22-PHASE-1-SHARED-INFRASTRUCTURE.md (Task 1.3b)
3. Implement: php/theme-storage.php, php/theme-rest-api.php

### "I need to implement theme CRUD operations"
1. Read: 24-WORDPRESS-INTEGRATION.md
2. Read: 12-THEME-SYSTEM.md (Theme Operations section)
3. Implement: shared/data/store.js
4. Implement: shared/theme-system/theme-manager.js

### "I need to implement accordion block"
1. Read: 31-ACCORDION-SPEC.md
2. Read: 30-SHARED-ATTRIBUTES.md
3. Read: 40-EDITOR-UI-PANELS.md
4. Implement: blocks/accordion/src/*

### "I need to implement customization cache"
1. Read: 13-CUSTOMIZATION-CACHE.md
2. Read: 42-CUSTOMIZATION-WORKFLOW.md
3. Implement: In edit.js (React state + setAttributes)

### "I need to style blocks"
1. Read: 23-CSS-PARSING-SYSTEM.md
2. Edit: assets/css/{blockType}.css (add :root variables)
3. Build: npm run build (auto-generates PHP)
4. Verify: php/css-defaults/{blockType}.php created

## Critical Rules

**DO NOT**:
- ❌ Edit files in build/ or php/css-defaults/ (auto-generated)
- ❌ Integrate cascade-resolver.js with @wordpress/data (performance)
- ❌ Read raw attributes in UI (use getAllEffectiveValues)
- ❌ Render before themes load (causes race conditions)

**DO**:
- ✅ Load themes on editor mount (useEffect)
- ✅ Use useSelect/useDispatch for theme operations
- ✅ Wrap @wordpress/components with customization indicators
- ✅ Keep cascade-resolver.js pure function (<5ms)
