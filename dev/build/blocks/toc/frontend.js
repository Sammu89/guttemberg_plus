(()=>{"use strict";const t={tablet:1024,mobile:600};let e,n=null;function i(){const e=document.querySelectorAll(".gutplus-toc");if(!e||0===e.length)return;const i=window.guttembergPlusSettings?.breakpoints||t,l=function(t,e){return t<=e.mobile?"mobile":t<=e.tablet?"tablet":"desktop"}(window.innerWidth,i);l!==n&&(n=l,e.forEach(t=>{t.setAttribute("data-gutplus-device",l)}))}function l(){const t=document.querySelectorAll(".gutplus-toc");t&&0!==t.length&&t.forEach(t=>{try{if(!t)return;const e=t.getAttribute("data-toc-id");if(!e)return void console.warn("TOC block missing data-toc-id attribute, skipping");const n={tocId:e,filterMode:t.getAttribute("data-filter-mode")||"include-all",includeLevels:(t.getAttribute("data-include-levels")||"2,3,4,5,6").split(",").map(Number),includeClasses:t.getAttribute("data-include-classes")||"",excludeLevels:(t.getAttribute("data-exclude-levels")||"").split(",").map(Number).filter(Boolean),excludeClasses:t.getAttribute("data-exclude-classes")||"",depthLimit:parseInt(t.getAttribute("data-depth-limit")||"0",10)||null,includeAccordions:"false"!==t.getAttribute("data-include-accordions"),includeTabs:"false"!==t.getAttribute("data-include-tabs"),h1NumberingStyle:t.getAttribute("data-h1-numbering")||"decimal",h2NumberingStyle:t.getAttribute("data-h2-numbering")||"decimal",h3NumberingStyle:t.getAttribute("data-h3-numbering")||"decimal",h4NumberingStyle:t.getAttribute("data-h4-numbering")||"decimal",h5NumberingStyle:t.getAttribute("data-h5-numbering")||"decimal",h6NumberingStyle:t.getAttribute("data-h6-numbering")||"decimal",smoothScroll:"true"===t.getAttribute("data-smooth-scroll"),scrollOffset:parseInt(t.getAttribute("data-scroll-offset")||"0",10),autoHighlight:"true"===t.getAttribute("data-auto-highlight"),isCollapsible:"true"===t.getAttribute("data-collapsible"),initiallyCollapsed:"true"===t.getAttribute("data-initially-collapsed"),clickBehavior:t.getAttribute("data-click-behavior")||"navigate",enableHierarchicalIndent:"true"===t.getAttribute("data-enable-hierarchical-indent"),levelIndent:t.getAttribute("data-level-indent")||"1.25rem",showIcon:"false"!==t.getAttribute("data-show-icon"),iconClosed:t.getAttribute("data-icon-closed")||"▾",iconOpen:t.getAttribute("data-icon-open")||"none",iconRotation:parseInt(t.getAttribute("data-icon-rotation")||"180",10),includeH1:"false"!==t.getAttribute("data-include-h1"),includeH2:"false"!==t.getAttribute("data-include-h2"),includeH3:"false"!==t.getAttribute("data-include-h3"),includeH4:"false"!==t.getAttribute("data-include-h4"),includeH5:"false"!==t.getAttribute("data-include-h5"),includeH6:"false"!==t.getAttribute("data-include-h6")};!function(t,e){if(t&&e)try{const n=function(t){if(!t)return[];const e=t.getAttribute("data-toc-items");if(!e)return[];try{const t=decodeURIComponent(e),n=JSON.parse(t);if(Array.isArray(n))return n.filter(t=>!t.hidden).map((t,e)=>{const n=t.anchor||t.id||`heading-${e}`;return{anchor:n,id:n,text:t.text||"",level:t.level||2}}).filter(t=>t.id)}catch(t){console.warn("Failed to parse curated TOC items",t)}return[]}(t),i=function(t,e){const n=document.querySelector(".entry-content, .post-content, .page-content, article .content, main.content, .site-content article");if(!n)return console.warn("TOC: Could not find content area. Headings will not be detected."),[];const i=[];if(["h1","h2","h3","h4","h5","h6"].forEach(t=>{!1!==e[`include${t.toUpperCase()}`]&&i.push(t)}),0===i.length)return[];const l=n.querySelectorAll(i.join(", ")),r=[];if(l.forEach(t=>{if(t.closest(".gutplus-toc"))return;if(t.closest("header, footer, nav, aside, .sidebar, .widget"))return;const n=parseInt(t.tagName.charAt(1),10),i=t.classList.contains("accordion-heading"),l=t.classList.contains("tab-heading");if(i&&!e.includeAccordions)return;if(l&&!e.includeTabs)return;let o="";const a=t.querySelector(".accordion-title-text, .tab-button-text");o=a?a.textContent.trim():t.textContent.trim();const c=t.id||"",s=Array.from(t.classList);(function(t,e){const{filterMode:n,includeClasses:i,excludeClasses:l}=e;return"Include by class"===n?!!i&&i.split(",").some(e=>t.classes.includes(e.trim())):"Excluse by class"!==n||(!l||!l.split(",").some(e=>t.classes.includes(e.trim())))})({level:n,classes:s},e)&&r.push({level:n,text:o,id:c,classes:s,element:t})}),e.depthLimit){const t=Math.min(...r.map(t=>t.level));return r.filter(n=>n.level-t<e.depthLimit)}return r}(0,e),l=n&&n.length>0?function(t,e,n){if(!Array.isArray(t)||0===t.length)return e||[];const i=Array.isArray(e)?e:[],l=new Map;i.forEach(t=>{t&&t.id&&l.set(t.id,t)});const o=new Set;return t.map((t,e)=>{const a=t.anchor||t.id||`heading-${n?.tocId||"toc"}-${e}`;let c=l.get(a);return c||(c=i.find(e=>!(o.has(e)||t.level&&e.level!==t.level||r(e.text)!==r(t.text)))),c?(o.add(c),c.element&&c.element.id!==a&&(c.element.id=a),{...c,id:a}):{level:t.level||2,text:t.text||"",id:a,element:null}})}(n,i,e):i;if(!l)return void console.warn("Failed to detect headings");l.forEach((t,n)=>{try{t&&t.element&&!t.element.id&&(t.element.id=`heading-${e.tocId}-${n}`,t.id=t.element.id)}catch(t){console.error("Failed to add ID to heading:",t)}});const o=t.querySelector(".toc-list");if(o)try{!function(t,e,n){t.innerHTML="",t.style.setProperty("--toc-h1-numbering",n.h1NumberingStyle||"decimal"),t.style.setProperty("--toc-h2-numbering",n.h2NumberingStyle||"decimal"),t.style.setProperty("--toc-h3-numbering",n.h3NumberingStyle||"decimal"),t.style.setProperty("--toc-h4-numbering",n.h4NumberingStyle||"decimal"),t.style.setProperty("--toc-h5-numbering",n.h5NumberingStyle||"decimal"),t.style.setProperty("--toc-h6-numbering",n.h6NumberingStyle||"decimal"),t.classList.add("toc-hierarchical-numbering"),t.setAttribute("data-h1-numbering",n.h1NumberingStyle||"decimal"),t.setAttribute("data-h2-numbering",n.h2NumberingStyle||"decimal"),t.setAttribute("data-h3-numbering",n.h3NumberingStyle||"decimal"),t.setAttribute("data-h4-numbering",n.h4NumberingStyle||"decimal"),t.setAttribute("data-h5-numbering",n.h5NumberingStyle||"decimal"),t.setAttribute("data-h6-numbering",n.h6NumberingStyle||"decimal");let i=e.length>0?Math.min(...e.map(t=>t.level||6)):1;if("none"===(n.h1NumberingStyle||"decimal")&&i<=1&&(i=2),t.setAttribute("data-base-level",i),0===e.length)return void(t.innerHTML='<li class="toc-empty">No headings found.</li>');const l=document.createDocumentFragment(),r=n&&n.enableHierarchicalIndent,o=n&&n.levelIndent||"1.25rem",a=[];let c=null;e.forEach(t=>{const e=document.createElement("li");e.className=`toc-item toc-h${t.level}`;let n=0;if(r){if(null===c)n=0,a.push(t.level);else if(t.level>c)n=a.length,a.push(t.level);else if(t.level===c)n=a.length-1;else{for(;a.length>0&&a[a.length-1]>=t.level;)a.pop();n=a.length,a.push(t.level)}c=t.level}else n=t.level-1;n>0&&(e.style.paddingLeft=`calc(${n} * ${o})`);const i=document.createElement("a");i.href=`#${t.id}`,i.className="toc-link",i.textContent=t.text,i.setAttribute("data-heading-id",t.id),e.appendChild(i),l.appendChild(e)}),t.appendChild(l)}(o,l,e)}catch(t){console.error("Failed to render TOC list:",t)}if(e.smoothScroll)try{!function(t,e){if(!t||!e)return;const n=t.querySelectorAll(".toc-link");n&&0!==n.length&&n.forEach(n=>{n&&n.addEventListener("click",i=>{try{i.preventDefault();const l=n.getAttribute("href");if(!l||l.length<=1)return void console.warn("Invalid TOC link href");const r=l.slice(1),o=document.getElementById(r);if(!o)return void console.warn("TOC target element not found:",r);const a=function(t){if(!t)return!1;let e=!1;const n=t.closest(".gutplus-accordion");if(n){const t=n.querySelector(".accordion-title"),i=n.querySelector(".accordion-content");t&&i&&("true"===t.getAttribute("aria-expanded")||(t.click(),e=!0))}let i=null;return t.classList&&t.classList.contains("tab-button")?i=t:t.closest&&t.closest(".tab-heading")?i=t.closest(".tab-heading").querySelector(".tab-button"):t.querySelector&&(i=t.querySelector(".tab-button")),i&&("true"===i.getAttribute("aria-selected")||(i.click(),e=!0)),e}(o),c=()=>{let t=o;const n=o.classList&&o.classList.contains("tab-button"),i=o.closest&&o.closest(".tab-heading");if(n||i){const e=o.closest(".gutplus-tabs");e&&(t=e)}const l=o.closest&&o.closest(".accordion-heading"),r=o.classList&&o.classList.contains("accordion-title");if(l||r){const e=o.closest(".gutplus-accordion");e&&(t=e)}const a=t.getBoundingClientRect().top+window.pageYOffset-e.scrollOffset;window.scrollTo({top:a,behavior:"smooth"})};a?setTimeout(c,50):c(),history.pushState?history.pushState(null,null,`#${r}`):window.location.hash=r,o.focus({preventScroll:!0}),"navigate-and-collapse"===e.clickBehavior&&e.isCollapsible&&e.showIcon&&setTimeout(()=>{try{const e=t.querySelector(".toc-toggle-button"),n=t.querySelector(".toc-content"),i=t.querySelector(".toc-icon");if(e&&n&&(n.setAttribute("hidden","true"),e.setAttribute("aria-expanded","false"),t.classList.remove("is-open"),i)){const t=e.getAttribute("data-icon-closed")||"▾";i.textContent=t,i.style.transform="rotate(0deg)"}}catch(t){console.error("Failed to collapse TOC:",t)}},600)}catch(t){console.error("Failed to handle smooth scroll:",t)}})})}(t,e)}catch(t){console.error("Failed to setup smooth scroll:",t)}if(e.autoHighlight)try{!function(t,e){if(!t||!e||0===e.length)return;const n=t.querySelectorAll(".toc-link");if(!n||0===n.length)return;const i=e.map(t=>t.element).filter(t=>t);if(0===i.length)return;const l=()=>{n.forEach(t=>{t&&t.classList.remove("active")})};let r=!1;const o=()=>{r||(window.requestAnimationFrame(()=>{try{const e=window.pageYOffset+100;let n=null;for(let t=i.length-1;t>=0;t--){const l=i[t];if(l&&void 0!==l.offsetTop&&e>=l.offsetTop){n=l;break}}n&&n.id?(e=>{if(!e)return;l();const n=t.querySelector(`.toc-link[data-heading-id="${e}"]`);n&&n.classList.add("active")})(n.id):l()}catch(t){console.error("Scroll spy error:",t)}r=!1}),r=!0)};try{o()}catch(t){console.error("Initial scroll spy check failed:",t)}window.addEventListener("scroll",o,{passive:!0})}(t,l)}catch(t){console.error("Failed to setup scroll spy:",t)}if(e.isCollapsible)try{!function(t,e){if(!t||!e)return;const n=t.querySelector(".toc-toggle-button"),i=t.querySelector(".toc-content"),l=t.querySelector(".toc-icon");if(!n||!i)return void console.warn("TOC collapsible elements not found");const r=!1!==e.showIcon,o=n.getAttribute("data-icon-closed")||"▾",a=n.getAttribute("data-icon-open")||"none",c=parseInt(n.getAttribute("data-icon-rotation")||"180",10);if(!r)return;const s=e.initiallyCollapsed;s?i.setAttribute("hidden","true"):(i.removeAttribute("hidden"),t.classList.add("is-open")),n.setAttribute("aria-expanded",!s),l&&!s&&(a&&"none"!==a?l.textContent=a:l.style.transform=`rotate(${c}deg)`);const d=()=>{try{i.hasAttribute("hidden")?(i.removeAttribute("hidden"),n.setAttribute("aria-expanded","true"),t.classList.add("is-open"),l&&(a&&"none"!==a?l.textContent=a:l.style.transform=`rotate(${c}deg)`)):(i.setAttribute("hidden","true"),n.setAttribute("aria-expanded","false"),t.classList.remove("is-open"),l&&(l.textContent=o,l.style.transform="rotate(0deg)"))}catch(t){console.error("Failed to toggle TOC:",t)}};n.addEventListener("click",d),n.addEventListener("keydown",t=>{t&&("Enter"!==t.key&&" "!==t.key||(t.preventDefault(),d()))})}(t,e)}catch(t){console.error("Failed to setup collapsible:",t)}}catch(t){console.error("Failed to initialize TOC:",t)}else console.warn("Invalid block or config in initTOC")}(t,n)}catch(t){console.error("Failed to initialize TOC block:",t)}})}function r(t=""){return t.toString().trim().toLowerCase()}if(window.addEventListener("resize",()=>{clearTimeout(e),e=setTimeout(i,100)}),"loading"===document.readyState)document.addEventListener("DOMContentLoaded",()=>{try{i(),l()}catch(t){console.error("TOC block initialization failed:",t)}});else try{l()}catch(t){console.error("TOC block initialization failed:",t)}})();