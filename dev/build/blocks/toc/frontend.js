(()=>{"use strict";var e={};function t(){const e=document.querySelectorAll(".gutplus-toc");e&&0!==e.length&&e.forEach(e=>{try{if(!e)return;const t=e.getAttribute("data-toc-id");if(!t)return void console.warn("TOC block missing data-toc-id attribute, skipping");const n={tocId:t,filterMode:e.getAttribute("data-filter-mode")||"include-all",includeLevels:(e.getAttribute("data-include-levels")||"2,3,4,5,6").split(",").map(Number),includeClasses:e.getAttribute("data-include-classes")||"",excludeLevels:(e.getAttribute("data-exclude-levels")||"").split(",").map(Number).filter(Boolean),excludeClasses:e.getAttribute("data-exclude-classes")||"",depthLimit:parseInt(e.getAttribute("data-depth-limit")||"0",10)||null,includeAccordions:"false"!==e.getAttribute("data-include-accordions"),includeTabs:"false"!==e.getAttribute("data-include-tabs"),numberingStyle:e.getAttribute("data-numbering-style")||"none",smoothScroll:"true"===e.getAttribute("data-smooth-scroll"),scrollOffset:parseInt(e.getAttribute("data-scroll-offset")||"0",10),autoHighlight:"true"===e.getAttribute("data-auto-highlight"),isCollapsible:"true"===e.getAttribute("data-collapsible"),initiallyCollapsed:"true"===e.getAttribute("data-initially-collapsed"),clickBehavior:e.getAttribute("data-click-behavior")||"navigate",enableHierarchicalIndent:"true"===e.getAttribute("data-enable-hierarchical-indent"),levelIndent:e.getAttribute("data-level-indent")||"1.25rem"};!function(e,t){if(e&&t)try{const n=function(e){if(!e)return[];const t=e.getAttribute("data-toc-items");if(!t)return[];try{const e=decodeURIComponent(t),l=JSON.parse(e);if(Array.isArray(l))return l.filter(e=>!e.hidden).map((e,t)=>{const l=e.anchor||e.id||`heading-${t}`;return{anchor:l,id:l,text:e.text||"",level:e.level||2}}).filter(e=>e.id)}catch(e){console.warn("Failed to parse curated TOC items",e)}return[]}(e),o=function(e,t){const l=document.querySelector(".entry-content, main, article, body");if(!l)return[];const n=l.querySelectorAll("h2, h3, h4, h5, h6"),o=[];if(n.forEach(e=>{if(e.closest(".gutplus-toc"))return;const l=parseInt(e.tagName.charAt(1),10),n=e.classList.contains("accordion-heading")||e.querySelector(".accordion-title-text"),r=e.querySelector(".tab-button-text");if(n&&!t.includeAccordions)return;if(r&&!t.includeTabs)return;let i="";const c=e.querySelector(".accordion-title-text, .tab-button-text");i=c?c.textContent.trim():e.textContent.trim();const a=e.id||"",s=Array.from(e.classList);(function(e,t){const{filterMode:l,includeLevels:n,includeClasses:o,excludeLevels:r,excludeClasses:i}=t;if("include-only"===l){const t=n.includes(e.level),l=!!o&&o.split(",").some(t=>e.classes.includes(t.trim()));return t||l}return"exclude"!==l||!r.includes(e.level)&&(!i||!i.split(",").some(t=>e.classes.includes(t.trim())))})({level:l,classes:s},t)&&o.push({level:l,text:i,id:a,classes:s,element:e})}),t.depthLimit){const e=Math.min(...o.map(e=>e.level));return o.filter(l=>l.level-e<t.depthLimit)}return o}(0,t),r=n&&n.length>0?function(e,t,n){if(!Array.isArray(e)||0===e.length)return t||[];const o=Array.isArray(t)?t:[],r=new Map;o.forEach(e=>{e&&e.id&&r.set(e.id,e)});const i=new Set;return e.map((e,t)=>{const c=e.anchor||e.id||`heading-${n?.tocId||"toc"}-${t}`;let a=r.get(c);return a||(a=o.find(t=>!(i.has(t)||e.level&&t.level!==e.level||l(t.text)!==l(e.text)))),a?(i.add(a),a.element&&a.element.id!==c&&(a.element.id=c),{...a,id:c}):{level:e.level||2,text:e.text||"",id:c,element:null}})}(n,o,t):o;if(!r)return void console.warn("Failed to detect headings");r.forEach((e,l)=>{try{e&&e.element&&!e.element.id&&(e.element.id=`heading-${t.tocId}-${l}`,e.id=e.element.id)}catch(e){console.error("Failed to add ID to heading:",e)}});const i=e.querySelector(".toc-list");if(i)try{!function(e,t,l){if(e.innerHTML="",0===t.length)return void(e.innerHTML='<li class="toc-empty">No headings found.</li>');const n=document.createDocumentFragment(),o=l&&l.enableHierarchicalIndent,r=l&&l.levelIndent||"1.25rem",i=[];let c=null;t.forEach(e=>{const t=document.createElement("li");t.className=`toc-item toc-h${e.level}`;let l=0;if(o){if(null===c)l=0,i.push(e.level);else if(e.level>c)l=i.length,i.push(e.level);else if(e.level===c)l=i.length-1;else{for(;i.length>0&&i[i.length-1]>=e.level;)i.pop();l=i.length,i.push(e.level)}c=e.level}else l=e.level-1;l>0&&(t.style.paddingLeft=`calc(${l} * ${r})`);const a=document.createElement("a");a.href=`#${e.id}`,a.className="toc-link",a.textContent=e.text,a.setAttribute("data-heading-id",e.id),t.appendChild(a),n.appendChild(t)}),e.appendChild(n)}(i,r,t)}catch(e){console.error("Failed to render TOC list:",e)}if(t.smoothScroll)try{!function(e,t){if(!e||!t)return;const l=e.querySelectorAll(".toc-link");l&&0!==l.length&&l.forEach(l=>{l&&l.addEventListener("click",n=>{try{n.preventDefault();const o=l.getAttribute("href");if(!o||o.length<=1)return void console.warn("Invalid TOC link href");const r=o.slice(1),i=document.getElementById(r);if(!i)return void console.warn("TOC target element not found:",r);const c=i.getBoundingClientRect().top+window.pageYOffset-t.scrollOffset;window.scrollTo({top:c,behavior:"smooth"}),history.pushState?history.pushState(null,null,`#${r}`):window.location.hash=r,i.focus({preventScroll:!0}),"navigate-and-collapse"===t.clickBehavior&&t.isCollapsible&&setTimeout(()=>{try{const t=e.querySelector(".toc-toggle-button"),l=e.querySelector(".toc-content"),n=e.querySelector(".toc-collapse-icon");t&&l&&(l.style.display="none",t.setAttribute("aria-expanded","false"),n&&(n.style.transform="rotate(-90deg)"))}catch(e){console.error("Failed to collapse TOC:",e)}},600)}catch(e){console.error("Failed to handle smooth scroll:",e)}})})}(e,t)}catch(e){console.error("Failed to setup smooth scroll:",e)}if(t.autoHighlight)try{!function(e,t){if(!e||!t||0===t.length)return;const l=e.querySelectorAll(".toc-link");if(!l||0===l.length)return;const n=t.map(e=>e.element).filter(e=>e);if(0===n.length)return;const o=()=>{l.forEach(e=>{e&&e.classList.remove("active")})};let r=!1;const i=()=>{r||(window.requestAnimationFrame(()=>{try{const t=window.pageYOffset+100;let l=null;for(let e=n.length-1;e>=0;e--){const o=n[e];if(o&&void 0!==o.offsetTop&&t>=o.offsetTop){l=o;break}}l&&l.id?(t=>{if(!t)return;o();const l=e.querySelector(`.toc-link[data-heading-id="${t}"]`);l&&l.classList.add("active")})(l.id):o()}catch(e){console.error("Scroll spy error:",e)}r=!1}),r=!0)};try{i()}catch(e){console.error("Initial scroll spy check failed:",e)}window.addEventListener("scroll",i,{passive:!0})}(e,r)}catch(e){console.error("Failed to setup scroll spy:",e)}if(t.isCollapsible)try{!function(e,t){if(!e||!t)return;const l=e.querySelector(".toc-toggle-button"),n=e.querySelector(".toc-content"),o=e.querySelector(".toc-collapse-icon");if(!l||!n)return void console.warn("TOC collapsible elements not found");const r=t.initiallyCollapsed;n.style.display=r?"none":"block",l.setAttribute("aria-expanded",!r);const i=()=>{try{"none"===n.style.display?(n.style.display="block",l.setAttribute("aria-expanded","true"),o&&(o.style.transform="rotate(0deg)")):(n.style.display="none",l.setAttribute("aria-expanded","false"),o&&(o.style.transform="rotate(-90deg)"))}catch(e){console.error("Failed to toggle TOC:",e)}};l.addEventListener("click",i),l.addEventListener("keydown",e=>{e&&("Enter"!==e.key&&" "!==e.key||(e.preventDefault(),i()))})}(e,t)}catch(e){console.error("Failed to setup collapsible:",e)}}catch(e){console.error("Failed to initialize TOC:",e)}else console.warn("Invalid block or config in initTOC")}(e,n)}catch(e){console.error("Failed to initialize TOC block:",e)}})}function l(e=""){return e.toString().trim().toLowerCase()}if(e.d=(t,l)=>{for(var n in l)e.o(l,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:l[n]})},e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),"loading"===document.readyState)document.addEventListener("DOMContentLoaded",()=>{try{t()}catch(e){console.error("TOC block initialization failed:",e)}});else try{t()}catch(e){console.error("TOC block initialization failed:",e)}})();