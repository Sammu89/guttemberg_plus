# Structure JSX Generator

Auto-generates the `renderTitle()` function for save.js and edit.js from the structure mapping JSON.

## Purpose

The structure mapping JSON defines the HTML structure with template directives (data-when, data-switch, data-slot, placeholders). This generator converts that template into React JSX code that can be directly used in the block's save.js and edit.js files.

## Usage

```javascript
const { generateStructureJsx } = require('./structure-jsx-generator');

// Load structure mapping
const structureMapping = require('../../schemas/accordion-structure-mapping-autogenerated.json');

// Generate for save mode
const saveCode = generateStructureJsx(structureMapping, 'save');

// Generate for edit mode
const editCode = generateStructureJsx(structureMapping, 'edit');
```

## Input

The generator expects a structure mapping JSON with this format:

```json
{
  "blockType": "accordion",
  "structure": {
    "elements": { /* element definitions */ },
    "slots": { /* slot definitions */ },
    "template": "<!-- HTML template with directives -->"
  }
}
```

## Output

The generator produces a complete `renderTitle()` function ready to be inserted into save.js or edit.js:

```javascript
/* ========== AUTO-GENERATED-RENDER-TITLE-START ========== */
// DO NOT EDIT - This code is auto-generated from schema
// AUTO-GENERATED from schemas/accordion-structure-mapping-autogenerated.json
// To modify, update the schema and run: npm run schema:build

/**
 * Render title with optional heading wrapper
 */
const renderTitle = () => {
  // ... generated code ...
};
/* ========== AUTO-GENERATED-RENDER-TITLE-END ========== */
```

## Modes

### save mode

Generates JSX for save.js with:
- `RichText.Content` components
- `InnerBlocks.Content` components
- ARIA attributes (`buttonAria`)
- No onChange handlers
- No placeholders

### edit mode

Generates JSX for edit.js with:
- `RichText` components with onChange handlers
- `InnerBlocks` components
- Placeholder text
- Formatting styles

## Convention-Based Detection

The generator uses naming conventions to determine component types:

1. **RichText Components**: Elements with IDs ending in `Text`
   - Example: `titleText` → RichText component for `title` attribute
   - save: `<RichText.Content tagName="span" value={attributes.title} />`
   - edit: `<RichText tagName="span" value={attributes.title} onChange={...} />`

2. **InnerBlocks Components**: Elements with IDs ending in `Slot` (except `iconSlot`)
   - Example: `contentSlot` → InnerBlocks component
   - save: `<InnerBlocks.Content />`
   - edit: `<InnerBlocks />`

3. **Icon Slots**: Elements with ID `iconSlot`
   - Wraps icon markup in a span
   - Children reference the `iconMarkup` slot

4. **Icon Elements**: Elements with IDs containing `icon` (not `iconSlot`)
   - Renders: `{ iconElement }`
   - Assumes `renderIcon()` function exists

## Template Directives

The generator handles these template directives:

1. **data-when**: Conditional rendering
   ```html
   <template data-when="headingLevel !== 'none'">
     <h{headingLevel}>...</h{headingLevel}>
   </template>
   ```
   Generates: `{ headingLevel !== 'none' && (...) }`

2. **data-else**: Else block
   ```html
   <template data-else>
     <button>...</button>
   </template>
   ```

3. **data-switch**: Switch expression
   ```html
   <template data-switch="iconPosition">
     <template data-case="box-left">...</template>
     <template data-case="box-right">...</template>
     <template data-default>...</template>
   </template>
   ```
   Generates: Ternary chain

4. **data-slot**: Slot reference or definition
   ```html
   <template data-slot="iconMarkup"></template>
   ```
   Generates: `{ renderIconMarkup() }`

5. **{placeholder}**: Variable substitution in tag names
   ```html
   <h{headingLevel}>...</h{headingLevel}>
   ```
   Generates: Dynamic tag with HeadingTag variable

6. **<slot>**: InnerBlocks placeholder
   ```html
   <slot data-el="contentSlot"></slot>
   ```
   Generates: `<InnerBlocks.Content />` or `<InnerBlocks />`

## Generated Function Structure

The `renderTitle()` function follows this structure:

1. **Extract values** from effectiveValues
2. **Get icon element** via `renderIcon()`
3. **Build button children** based on iconPosition
   - box-left: icon slot + text wrapper
   - box-right: text wrapper + icon slot
   - left: inline div with icon + text
   - right (default): inline div with text + icon
4. **Create button content** with classes and ARIA
5. **Wrap in heading** if headingLevel !== 'none'
6. **Return** button or heading

## Testing

Run the test script:

```bash
cd build-tools/generators
node test-structure-generator.js
```

This will generate both save and edit modes and display the output.

## Integration

To use this generator in the build process:

1. Load the structure mapping JSON
2. Call `generateStructureJsx(structureMapping, 'save')` for save.js
3. Call `generateStructureJsx(structureMapping, 'edit')` for edit.js
4. Insert the generated code between the AUTO-GENERATED markers

## Maintenance

When updating the generator:

1. Test with `node test-structure-generator.js`
2. Compare output with existing save.js/edit.js
3. Ensure formatting and indentation match
4. Verify both save and edit modes work correctly

## Future Enhancements

Potential improvements:

1. **Generic block support**: Make it work for tabs, toc, etc.
2. **Full template parsing**: Parse the entire template, not just titleButton
3. **Advanced directives**: Support for loops, nested conditions
4. **Custom attributes**: Allow custom attribute mappings
5. **Validation**: Validate structure mapping before generation
