(()=>{"use strict";var e={};function t(){const e=document.querySelectorAll(".gutplus-toc");e&&0!==e.length&&e.forEach(e=>{try{if(!e)return;const t=e.getAttribute("data-toc-id");if(!t)return void console.warn("TOC block missing data-toc-id attribute, skipping");const o={tocId:t,filterMode:e.getAttribute("data-filter-mode")||"include-all",includeLevels:(e.getAttribute("data-include-levels")||"2,3,4,5,6").split(",").map(Number),includeClasses:e.getAttribute("data-include-classes")||"",excludeLevels:(e.getAttribute("data-exclude-levels")||"").split(",").map(Number).filter(Boolean),excludeClasses:e.getAttribute("data-exclude-classes")||"",depthLimit:parseInt(e.getAttribute("data-depth-limit")||"0",10)||null,includeAccordions:"false"!==e.getAttribute("data-include-accordions"),includeTabs:"false"!==e.getAttribute("data-include-tabs"),numberingStyle:e.getAttribute("data-numbering-style")||"none",smoothScroll:"true"===e.getAttribute("data-smooth-scroll"),scrollOffset:parseInt(e.getAttribute("data-scroll-offset")||"0",10),autoHighlight:"true"===e.getAttribute("data-auto-highlight"),isCollapsible:"true"===e.getAttribute("data-collapsible"),initiallyCollapsed:"true"===e.getAttribute("data-initially-collapsed"),clickBehavior:e.getAttribute("data-click-behavior")||"navigate"};!function(e,t){if(e&&t)try{const o=function(e,t){const o=document.querySelector(".entry-content, main, article, body");if(!o)return[];const l=o.querySelectorAll("h2, h3, h4, h5, h6"),n=[];if(l.forEach(e=>{if(e.closest(".gutplus-toc"))return;const o=parseInt(e.tagName.charAt(1),10),l=e.classList.contains("accordion-heading")||e.querySelector(".accordion-title-text"),i=e.querySelector(".tab-button-text");if(l&&!t.includeAccordions)return;if(i&&!t.includeTabs)return;let r="";const c=e.querySelector(".accordion-title-text, .tab-button-text");r=c?c.textContent.trim():e.textContent.trim();const a=e.id||"",s=Array.from(e.classList);(function(e,t){const{filterMode:o,includeLevels:l,includeClasses:n,excludeLevels:i,excludeClasses:r}=t;if("include-only"===o){const t=l.includes(e.level),o=!!n&&n.split(",").some(t=>e.classes.includes(t.trim()));return t||o}return"exclude"!==o||!i.includes(e.level)&&(!r||!r.split(",").some(t=>e.classes.includes(t.trim())))})({level:o,classes:s},t)&&n.push({level:o,text:r,id:a,classes:s,element:e})}),t.depthLimit){const e=Math.min(...n.map(e=>e.level));return n.filter(o=>o.level-e<t.depthLimit)}return n}(0,t);if(!o)return void console.warn("Failed to detect headings");o.forEach((e,o)=>{try{e&&e.element&&!e.element.id&&(e.element.id=`heading-${t.tocId}-${o}`,e.id=e.element.id)}catch(e){console.error("Failed to add ID to heading:",e)}});const l=e.querySelector(".toc-list");if(l)try{!function(e,t){if(e.innerHTML="",0===t.length)return void(e.innerHTML='<li class="toc-empty">No headings found.</li>');const o=document.createDocumentFragment();t.forEach(e=>{const t=document.createElement("li");t.className=`toc-item toc-item-level-${e.level}`;const l=document.createElement("a");l.href=`#${e.id}`,l.className="toc-link",l.textContent=e.text,l.setAttribute("data-heading-id",e.id),t.appendChild(l),o.appendChild(t)}),e.appendChild(o)}(l,o)}catch(e){console.error("Failed to render TOC list:",e)}if(t.smoothScroll)try{!function(e,t){if(!e||!t)return;const o=e.querySelectorAll(".toc-link");o&&0!==o.length&&o.forEach(o=>{o&&o.addEventListener("click",l=>{try{l.preventDefault();const n=o.getAttribute("href");if(!n||n.length<=1)return void console.warn("Invalid TOC link href");const i=n.slice(1),r=document.getElementById(i);if(!r)return void console.warn("TOC target element not found:",i);const c=r.getBoundingClientRect().top+window.pageYOffset-t.scrollOffset;window.scrollTo({top:c,behavior:"smooth"}),history.pushState?history.pushState(null,null,`#${i}`):window.location.hash=i,r.focus({preventScroll:!0}),"navigate-and-collapse"===t.clickBehavior&&t.isCollapsible&&setTimeout(()=>{try{const t=e.querySelector(".toc-toggle-button"),o=e.querySelector(".toc-content"),l=e.querySelector(".toc-collapse-icon");t&&o&&(o.style.display="none",t.setAttribute("aria-expanded","false"),l&&(l.style.transform="rotate(-90deg)"))}catch(e){console.error("Failed to collapse TOC:",e)}},600)}catch(e){console.error("Failed to handle smooth scroll:",e)}})})}(e,t)}catch(e){console.error("Failed to setup smooth scroll:",e)}if(t.autoHighlight)try{!function(e,t){if(!e||!t||0===t.length)return;const o=e.querySelectorAll(".toc-link");if(!o||0===o.length)return;const l=t.map(e=>e.element).filter(e=>e);if(0===l.length)return;const n=()=>{o.forEach(e=>{e&&e.classList.remove("active")})};let i=!1;const r=()=>{i||(window.requestAnimationFrame(()=>{try{const t=window.pageYOffset+100;let o=null;for(let e=l.length-1;e>=0;e--){const n=l[e];if(n&&void 0!==n.offsetTop&&t>=n.offsetTop){o=n;break}}o&&o.id?(t=>{if(!t)return;n();const o=e.querySelector(`.toc-link[data-heading-id="${t}"]`);o&&o.classList.add("active")})(o.id):n()}catch(e){console.error("Scroll spy error:",e)}i=!1}),i=!0)};try{r()}catch(e){console.error("Initial scroll spy check failed:",e)}window.addEventListener("scroll",r,{passive:!0})}(e,o)}catch(e){console.error("Failed to setup scroll spy:",e)}if(t.isCollapsible)try{!function(e,t){if(!e||!t)return;const o=e.querySelector(".toc-toggle-button"),l=e.querySelector(".toc-content"),n=e.querySelector(".toc-collapse-icon");if(!o||!l)return void console.warn("TOC collapsible elements not found");const i=t.initiallyCollapsed;l.style.display=i?"none":"block",o.setAttribute("aria-expanded",!i);const r=()=>{try{"none"===l.style.display?(l.style.display="block",o.setAttribute("aria-expanded","true"),n&&(n.style.transform="rotate(0deg)")):(l.style.display="none",o.setAttribute("aria-expanded","false"),n&&(n.style.transform="rotate(-90deg)"))}catch(e){console.error("Failed to toggle TOC:",e)}};o.addEventListener("click",r),o.addEventListener("keydown",e=>{e&&("Enter"!==e.key&&" "!==e.key||(e.preventDefault(),r()))})}(e,t)}catch(e){console.error("Failed to setup collapsible:",e)}}catch(e){console.error("Failed to initialize TOC:",e)}else console.warn("Invalid block or config in initTOC")}(e,o)}catch(e){console.error("Failed to initialize TOC block:",e)}})}if(e.d=(t,o)=>{for(var l in o)e.o(o,l)&&!e.o(t,l)&&Object.defineProperty(t,l,{enumerable:!0,get:o[l]})},e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),"loading"===document.readyState)document.addEventListener("DOMContentLoaded",()=>{try{t()}catch(e){console.error("TOC block initialization failed:",e)}});else try{t()}catch(e){console.error("TOC block initialization failed:",e)}})();