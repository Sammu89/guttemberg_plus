(()=>{"use strict";var e={};function t(){const e=document.querySelectorAll(".gutplus-toc");e&&0!==e.length&&e.forEach(e=>{try{if(!e)return;const t=e.getAttribute("data-toc-id");if(!t)return void console.warn("TOC block missing data-toc-id attribute, skipping");const i={tocId:t,filterMode:e.getAttribute("data-filter-mode")||"include-all",includeLevels:(e.getAttribute("data-include-levels")||"2,3,4,5,6").split(",").map(Number),includeClasses:e.getAttribute("data-include-classes")||"",excludeLevels:(e.getAttribute("data-exclude-levels")||"").split(",").map(Number).filter(Boolean),excludeClasses:e.getAttribute("data-exclude-classes")||"",depthLimit:parseInt(e.getAttribute("data-depth-limit")||"0",10)||null,includeAccordions:"false"!==e.getAttribute("data-include-accordions"),includeTabs:"false"!==e.getAttribute("data-include-tabs"),h1NumberingStyle:e.getAttribute("data-h1-numbering")||"decimal",h2NumberingStyle:e.getAttribute("data-h2-numbering")||"decimal",h3NumberingStyle:e.getAttribute("data-h3-numbering")||"decimal",h4NumberingStyle:e.getAttribute("data-h4-numbering")||"decimal",h5NumberingStyle:e.getAttribute("data-h5-numbering")||"decimal",h6NumberingStyle:e.getAttribute("data-h6-numbering")||"decimal",smoothScroll:"true"===e.getAttribute("data-smooth-scroll"),scrollOffset:parseInt(e.getAttribute("data-scroll-offset")||"0",10),autoHighlight:"true"===e.getAttribute("data-auto-highlight"),isCollapsible:"true"===e.getAttribute("data-collapsible"),initiallyCollapsed:"true"===e.getAttribute("data-initially-collapsed"),clickBehavior:e.getAttribute("data-click-behavior")||"navigate",enableHierarchicalIndent:"true"===e.getAttribute("data-enable-hierarchical-indent"),levelIndent:e.getAttribute("data-level-indent")||"1.25rem",showIcon:"false"!==e.getAttribute("data-show-icon"),iconClosed:e.getAttribute("data-icon-closed")||"▾",iconOpen:e.getAttribute("data-icon-open")||"none",iconRotation:parseInt(e.getAttribute("data-icon-rotation")||"180",10),includeH1:"false"!==e.getAttribute("data-include-h1"),includeH2:"false"!==e.getAttribute("data-include-h2"),includeH3:"false"!==e.getAttribute("data-include-h3"),includeH4:"false"!==e.getAttribute("data-include-h4"),includeH5:"false"!==e.getAttribute("data-include-h5"),includeH6:"false"!==e.getAttribute("data-include-h6")};!function(e,t){if(e&&t)try{const i=function(e){if(!e)return[];const t=e.getAttribute("data-toc-items");if(!t)return[];try{const e=decodeURIComponent(t),n=JSON.parse(e);if(Array.isArray(n))return n.filter(e=>!e.hidden).map((e,t)=>{const n=e.anchor||e.id||`heading-${t}`;return{anchor:n,id:n,text:e.text||"",level:e.level||2}}).filter(e=>e.id)}catch(e){console.warn("Failed to parse curated TOC items",e)}return[]}(e),l=function(e,t){const n=document.querySelector(".entry-content, .post-content, .page-content, article .content, main.content, .site-content article");if(!n)return console.warn("TOC: Could not find content area. Headings will not be detected."),[];const i=[];if(["h1","h2","h3","h4","h5","h6"].forEach(e=>{!1!==t[`include${e.toUpperCase()}`]&&i.push(e)}),0===i.length)return[];const l=n.querySelectorAll(i.join(", ")),r=[];if(l.forEach(e=>{if(e.closest(".gutplus-toc"))return;if(e.closest("header, footer, nav, aside, .sidebar, .widget"))return;const n=parseInt(e.tagName.charAt(1),10),i=e.classList.contains("accordion-heading"),l=e.classList.contains("tab-heading");if(i&&!t.includeAccordions)return;if(l&&!t.includeTabs)return;let o="";const a=e.querySelector(".accordion-title-text, .tab-button-text");o=a?a.textContent.trim():e.textContent.trim();const c=e.id||"",s=Array.from(e.classList);(function(e,t){const{filterMode:n,includeClasses:i,excludeClasses:l}=t;return"Include by class"===n?!!i&&i.split(",").some(t=>e.classes.includes(t.trim())):"Excluse by class"!==n||(!l||!l.split(",").some(t=>e.classes.includes(t.trim())))})({level:n,classes:s},t)&&r.push({level:n,text:o,id:c,classes:s,element:e})}),t.depthLimit){const e=Math.min(...r.map(e=>e.level));return r.filter(n=>n.level-e<t.depthLimit)}return r}(0,t),r=i&&i.length>0?function(e,t,i){if(!Array.isArray(e)||0===e.length)return t||[];const l=Array.isArray(t)?t:[],r=new Map;l.forEach(e=>{e&&e.id&&r.set(e.id,e)});const o=new Set;return e.map((e,t)=>{const a=e.anchor||e.id||`heading-${i?.tocId||"toc"}-${t}`;let c=r.get(a);return c||(c=l.find(t=>!(o.has(t)||e.level&&t.level!==e.level||n(t.text)!==n(e.text)))),c?(o.add(c),c.element&&c.element.id!==a&&(c.element.id=a),{...c,id:a}):{level:e.level||2,text:e.text||"",id:a,element:null}})}(i,l,t):l;if(!r)return void console.warn("Failed to detect headings");r.forEach((e,n)=>{try{e&&e.element&&!e.element.id&&(e.element.id=`heading-${t.tocId}-${n}`,e.id=e.element.id)}catch(e){console.error("Failed to add ID to heading:",e)}});const o=e.querySelector(".toc-list");if(o)try{!function(e,t,n){e.innerHTML="",e.style.setProperty("--toc-h1-numbering",n.h1NumberingStyle||"decimal"),e.style.setProperty("--toc-h2-numbering",n.h2NumberingStyle||"decimal"),e.style.setProperty("--toc-h3-numbering",n.h3NumberingStyle||"decimal"),e.style.setProperty("--toc-h4-numbering",n.h4NumberingStyle||"decimal"),e.style.setProperty("--toc-h5-numbering",n.h5NumberingStyle||"decimal"),e.style.setProperty("--toc-h6-numbering",n.h6NumberingStyle||"decimal"),e.classList.add("toc-hierarchical-numbering"),e.setAttribute("data-h1-numbering",n.h1NumberingStyle||"decimal"),e.setAttribute("data-h2-numbering",n.h2NumberingStyle||"decimal"),e.setAttribute("data-h3-numbering",n.h3NumberingStyle||"decimal"),e.setAttribute("data-h4-numbering",n.h4NumberingStyle||"decimal"),e.setAttribute("data-h5-numbering",n.h5NumberingStyle||"decimal"),e.setAttribute("data-h6-numbering",n.h6NumberingStyle||"decimal");let i=t.length>0?Math.min(...t.map(e=>e.level||6)):1;if("none"===(n.h1NumberingStyle||"decimal")&&i<=1&&(i=2),e.setAttribute("data-base-level",i),0===t.length)return void(e.innerHTML='<li class="toc-empty">No headings found.</li>');const l=document.createDocumentFragment(),r=n&&n.enableHierarchicalIndent,o=n&&n.levelIndent||"1.25rem",a=[];let c=null;t.forEach(e=>{const t=document.createElement("li");t.className=`toc-item toc-h${e.level}`;let n=0;if(r){if(null===c)n=0,a.push(e.level);else if(e.level>c)n=a.length,a.push(e.level);else if(e.level===c)n=a.length-1;else{for(;a.length>0&&a[a.length-1]>=e.level;)a.pop();n=a.length,a.push(e.level)}c=e.level}else n=e.level-1;n>0&&(t.style.paddingLeft=`calc(${n} * ${o})`);const i=document.createElement("a");i.href=`#${e.id}`,i.className="toc-link",i.textContent=e.text,i.setAttribute("data-heading-id",e.id),t.appendChild(i),l.appendChild(t)}),e.appendChild(l)}(o,r,t)}catch(e){console.error("Failed to render TOC list:",e)}if(t.smoothScroll)try{!function(e,t){if(!e||!t)return;const n=e.querySelectorAll(".toc-link");n&&0!==n.length&&n.forEach(n=>{n&&n.addEventListener("click",i=>{try{i.preventDefault();const l=n.getAttribute("href");if(!l||l.length<=1)return void console.warn("Invalid TOC link href");const r=l.slice(1),o=document.getElementById(r);if(!o)return void console.warn("TOC target element not found:",r);const a=function(e){if(!e)return!1;let t=!1;const n=e.closest(".gutplus-accordion");if(n){const e=n.querySelector(".accordion-title"),i=n.querySelector(".accordion-content");e&&i&&("true"===e.getAttribute("aria-expanded")||(e.click(),t=!0))}let i=null;return e.classList&&e.classList.contains("tab-button")?i=e:e.closest&&e.closest(".tab-heading")?i=e.closest(".tab-heading").querySelector(".tab-button"):e.querySelector&&(i=e.querySelector(".tab-button")),i&&("true"===i.getAttribute("aria-selected")||(i.click(),t=!0)),t}(o),c=()=>{let e=o;const n=o.classList&&o.classList.contains("tab-button"),i=o.closest&&o.closest(".tab-heading");if(n||i){const t=o.closest(".gutplus-tabs");t&&(e=t)}const l=o.closest&&o.closest(".accordion-heading"),r=o.classList&&o.classList.contains("accordion-title");if(l||r){const t=o.closest(".gutplus-accordion");t&&(e=t)}const a=e.getBoundingClientRect().top+window.pageYOffset-t.scrollOffset;window.scrollTo({top:a,behavior:"smooth"})};a?setTimeout(c,50):c(),history.pushState?history.pushState(null,null,`#${r}`):window.location.hash=r,o.focus({preventScroll:!0}),"navigate-and-collapse"===t.clickBehavior&&t.isCollapsible&&t.showIcon&&setTimeout(()=>{try{const t=e.querySelector(".toc-toggle-button"),n=e.querySelector(".toc-content"),i=e.querySelector(".toc-icon");if(t&&n&&(n.setAttribute("hidden","true"),t.setAttribute("aria-expanded","false"),e.classList.remove("is-open"),i)){const e=t.getAttribute("data-icon-closed")||"▾";i.textContent=e,i.style.transform="rotate(0deg)"}}catch(e){console.error("Failed to collapse TOC:",e)}},600)}catch(e){console.error("Failed to handle smooth scroll:",e)}})})}(e,t)}catch(e){console.error("Failed to setup smooth scroll:",e)}if(t.autoHighlight)try{!function(e,t){if(!e||!t||0===t.length)return;const n=e.querySelectorAll(".toc-link");if(!n||0===n.length)return;const i=t.map(e=>e.element).filter(e=>e);if(0===i.length)return;const l=()=>{n.forEach(e=>{e&&e.classList.remove("active")})};let r=!1;const o=()=>{r||(window.requestAnimationFrame(()=>{try{const t=window.pageYOffset+100;let n=null;for(let e=i.length-1;e>=0;e--){const l=i[e];if(l&&void 0!==l.offsetTop&&t>=l.offsetTop){n=l;break}}n&&n.id?(t=>{if(!t)return;l();const n=e.querySelector(`.toc-link[data-heading-id="${t}"]`);n&&n.classList.add("active")})(n.id):l()}catch(e){console.error("Scroll spy error:",e)}r=!1}),r=!0)};try{o()}catch(e){console.error("Initial scroll spy check failed:",e)}window.addEventListener("scroll",o,{passive:!0})}(e,r)}catch(e){console.error("Failed to setup scroll spy:",e)}if(t.isCollapsible)try{!function(e,t){if(!e||!t)return;const n=e.querySelector(".toc-toggle-button"),i=e.querySelector(".toc-content"),l=e.querySelector(".toc-icon");if(!n||!i)return void console.warn("TOC collapsible elements not found");const r=!1!==t.showIcon,o=n.getAttribute("data-icon-closed")||"▾",a=n.getAttribute("data-icon-open")||"none",c=parseInt(n.getAttribute("data-icon-rotation")||"180",10);if(!r)return;const s=t.initiallyCollapsed;s?i.setAttribute("hidden","true"):(i.removeAttribute("hidden"),e.classList.add("is-open")),n.setAttribute("aria-expanded",!s),l&&!s&&(a&&"none"!==a?l.textContent=a:l.style.transform=`rotate(${c}deg)`);const d=()=>{try{i.hasAttribute("hidden")?(i.removeAttribute("hidden"),n.setAttribute("aria-expanded","true"),e.classList.add("is-open"),l&&(a&&"none"!==a?l.textContent=a:l.style.transform=`rotate(${c}deg)`)):(i.setAttribute("hidden","true"),n.setAttribute("aria-expanded","false"),e.classList.remove("is-open"),l&&(l.textContent=o,l.style.transform="rotate(0deg)"))}catch(e){console.error("Failed to toggle TOC:",e)}};n.addEventListener("click",d),n.addEventListener("keydown",e=>{e&&("Enter"!==e.key&&" "!==e.key||(e.preventDefault(),d()))})}(e,t)}catch(e){console.error("Failed to setup collapsible:",e)}}catch(e){console.error("Failed to initialize TOC:",e)}else console.warn("Invalid block or config in initTOC")}(e,i)}catch(e){console.error("Failed to initialize TOC block:",e)}})}function n(e=""){return e.toString().trim().toLowerCase()}if(e.d=(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),"loading"===document.readyState)document.addEventListener("DOMContentLoaded",()=>{try{t()}catch(e){console.error("TOC block initialization failed:",e)}});else try{t()}catch(e){console.error("TOC block initialization failed:",e)}})();