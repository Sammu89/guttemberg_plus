(()=>{"use strict";var e={};function t(){const e=document.querySelectorAll(".gutplus-toc");e&&0!==e.length&&e.forEach(e=>{try{if(!e)return;const t=e.getAttribute("data-toc-id");if(!t)return void console.warn("TOC block missing data-toc-id attribute, skipping");const o={tocId:t,filterMode:e.getAttribute("data-filter-mode")||"include-all",includeLevels:(e.getAttribute("data-include-levels")||"2,3,4,5,6").split(",").map(Number),includeClasses:e.getAttribute("data-include-classes")||"",excludeLevels:(e.getAttribute("data-exclude-levels")||"").split(",").map(Number).filter(Boolean),excludeClasses:e.getAttribute("data-exclude-classes")||"",depthLimit:parseInt(e.getAttribute("data-depth-limit")||"0",10)||null,includeAccordions:"false"!==e.getAttribute("data-include-accordions"),includeTabs:"false"!==e.getAttribute("data-include-tabs"),numberingStyle:e.getAttribute("data-numbering-style")||"none",smoothScroll:"true"===e.getAttribute("data-smooth-scroll"),scrollOffset:parseInt(e.getAttribute("data-scroll-offset")||"0",10),autoHighlight:"true"===e.getAttribute("data-auto-highlight"),isCollapsible:"true"===e.getAttribute("data-collapsible"),initiallyCollapsed:"true"===e.getAttribute("data-initially-collapsed"),clickBehavior:e.getAttribute("data-click-behavior")||"navigate"};!function(e,t){if(e&&t)try{const o=function(e){if(!e)return[];const t=e.getAttribute("data-toc-items");if(!t)return[];try{const e=decodeURIComponent(t),l=JSON.parse(e);if(Array.isArray(l))return l.filter(e=>!e.hidden).map((e,t)=>{const l=e.anchor||e.id||`heading-${t}`;return{anchor:l,id:l,text:e.text||"",level:e.level||2}}).filter(e=>e.id)}catch(e){console.warn("Failed to parse curated TOC items",e)}return[]}(e),n=function(e,t){const l=document.querySelector(".entry-content, main, article, body");if(!l)return[];const o=l.querySelectorAll("h2, h3, h4, h5, h6"),n=[];if(o.forEach(e=>{if(e.closest(".gutplus-toc"))return;const l=parseInt(e.tagName.charAt(1),10),o=e.classList.contains("accordion-heading")||e.querySelector(".accordion-title-text"),r=e.querySelector(".tab-button-text");if(o&&!t.includeAccordions)return;if(r&&!t.includeTabs)return;let i="";const c=e.querySelector(".accordion-title-text, .tab-button-text");i=c?c.textContent.trim():e.textContent.trim();const a=e.id||"",s=Array.from(e.classList);(function(e,t){const{filterMode:l,includeLevels:o,includeClasses:n,excludeLevels:r,excludeClasses:i}=t;if("include-only"===l){const t=o.includes(e.level),l=!!n&&n.split(",").some(t=>e.classes.includes(t.trim()));return t||l}return"exclude"!==l||!r.includes(e.level)&&(!i||!i.split(",").some(t=>e.classes.includes(t.trim())))})({level:l,classes:s},t)&&n.push({level:l,text:i,id:a,classes:s,element:e})}),t.depthLimit){const e=Math.min(...n.map(e=>e.level));return n.filter(l=>l.level-e<t.depthLimit)}return n}(0,t),r=o&&o.length>0?function(e,t,o){if(!Array.isArray(e)||0===e.length)return t||[];const n=Array.isArray(t)?t:[],r=new Map;n.forEach(e=>{e&&e.id&&r.set(e.id,e)});const i=new Set;return e.map((e,t)=>{const c=e.anchor||e.id||`heading-${o?.tocId||"toc"}-${t}`;let a=r.get(c);return a||(a=n.find(t=>!(i.has(t)||e.level&&t.level!==e.level||l(t.text)!==l(e.text)))),a?(i.add(a),a.element&&a.element.id!==c&&(a.element.id=c),{...a,id:c}):{level:e.level||2,text:e.text||"",id:c,element:null}})}(o,n,t):n;if(!r)return void console.warn("Failed to detect headings");r.forEach((e,l)=>{try{e&&e.element&&!e.element.id&&(e.element.id=`heading-${t.tocId}-${l}`,e.id=e.element.id)}catch(e){console.error("Failed to add ID to heading:",e)}});const i=e.querySelector(".toc-list");if(i)try{!function(e,t){if(e.innerHTML="",0===t.length)return void(e.innerHTML='<li class="toc-empty">No headings found.</li>');const l=document.createDocumentFragment();t.forEach(e=>{const t=document.createElement("li"),o=e.level-1;t.className=`toc-item toc-level-${o}`;const n=document.createElement("a");n.href=`#${e.id}`,n.className="toc-link",n.textContent=e.text,n.setAttribute("data-heading-id",e.id),t.appendChild(n),l.appendChild(t)}),e.appendChild(l)}(i,r)}catch(e){console.error("Failed to render TOC list:",e)}if(t.smoothScroll)try{!function(e,t){if(!e||!t)return;const l=e.querySelectorAll(".toc-link");l&&0!==l.length&&l.forEach(l=>{l&&l.addEventListener("click",o=>{try{o.preventDefault();const n=l.getAttribute("href");if(!n||n.length<=1)return void console.warn("Invalid TOC link href");const r=n.slice(1),i=document.getElementById(r);if(!i)return void console.warn("TOC target element not found:",r);const c=i.getBoundingClientRect().top+window.pageYOffset-t.scrollOffset;window.scrollTo({top:c,behavior:"smooth"}),history.pushState?history.pushState(null,null,`#${r}`):window.location.hash=r,i.focus({preventScroll:!0}),"navigate-and-collapse"===t.clickBehavior&&t.isCollapsible&&setTimeout(()=>{try{const t=e.querySelector(".toc-toggle-button"),l=e.querySelector(".toc-content"),o=e.querySelector(".toc-collapse-icon");t&&l&&(l.style.display="none",t.setAttribute("aria-expanded","false"),o&&(o.style.transform="rotate(-90deg)"))}catch(e){console.error("Failed to collapse TOC:",e)}},600)}catch(e){console.error("Failed to handle smooth scroll:",e)}})})}(e,t)}catch(e){console.error("Failed to setup smooth scroll:",e)}if(t.autoHighlight)try{!function(e,t){if(!e||!t||0===t.length)return;const l=e.querySelectorAll(".toc-link");if(!l||0===l.length)return;const o=t.map(e=>e.element).filter(e=>e);if(0===o.length)return;const n=()=>{l.forEach(e=>{e&&e.classList.remove("active")})};let r=!1;const i=()=>{r||(window.requestAnimationFrame(()=>{try{const t=window.pageYOffset+100;let l=null;for(let e=o.length-1;e>=0;e--){const n=o[e];if(n&&void 0!==n.offsetTop&&t>=n.offsetTop){l=n;break}}l&&l.id?(t=>{if(!t)return;n();const l=e.querySelector(`.toc-link[data-heading-id="${t}"]`);l&&l.classList.add("active")})(l.id):n()}catch(e){console.error("Scroll spy error:",e)}r=!1}),r=!0)};try{i()}catch(e){console.error("Initial scroll spy check failed:",e)}window.addEventListener("scroll",i,{passive:!0})}(e,r)}catch(e){console.error("Failed to setup scroll spy:",e)}if(t.isCollapsible)try{!function(e,t){if(!e||!t)return;const l=e.querySelector(".toc-toggle-button"),o=e.querySelector(".toc-content"),n=e.querySelector(".toc-collapse-icon");if(!l||!o)return void console.warn("TOC collapsible elements not found");const r=t.initiallyCollapsed;o.style.display=r?"none":"block",l.setAttribute("aria-expanded",!r);const i=()=>{try{"none"===o.style.display?(o.style.display="block",l.setAttribute("aria-expanded","true"),n&&(n.style.transform="rotate(0deg)")):(o.style.display="none",l.setAttribute("aria-expanded","false"),n&&(n.style.transform="rotate(-90deg)"))}catch(e){console.error("Failed to toggle TOC:",e)}};l.addEventListener("click",i),l.addEventListener("keydown",e=>{e&&("Enter"!==e.key&&" "!==e.key||(e.preventDefault(),i()))})}(e,t)}catch(e){console.error("Failed to setup collapsible:",e)}}catch(e){console.error("Failed to initialize TOC:",e)}else console.warn("Invalid block or config in initTOC")}(e,o)}catch(e){console.error("Failed to initialize TOC block:",e)}})}function l(e=""){return e.toString().trim().toLowerCase()}if(e.d=(t,l)=>{for(var o in l)e.o(l,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:l[o]})},e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),"loading"===document.readyState)document.addEventListener("DOMContentLoaded",()=>{try{t()}catch(e){console.error("TOC block initialization failed:",e)}});else try{t()}catch(e){console.error("TOC block initialization failed:",e)}})();